# Сбор и аналитическая обработка информации о сетевом трафике
Семёнова София БИСО-03-20

# Лабораторная работа №2 сбор и аналитическая обработка информации о сетевом трафике

## Цель работы

1.  Развить практические навыки использования современного стека
    инструментов сбора и аналитической обработки информации о сетвом
    трафике
2.  Освоить базовые подходы блокировки нежелательного сетевого трафика
3.  Закрепить знания о современных сетевых протоколах прикладного уровня

## Ход работы

1.  С помощью Wireshark был собран сетевой трафик объёмом 146 Мб и
    записан в файл data.pcapng

2.  С помощью Zeek была выделена метаинформация сетевого трафика (файл dns.log)

``` bash
/opt/zeek/bin/zeek -C -r /home/sofiya/data.pcapng
```

3. Проанализируем полученный трафик:

Получим список нежелательных доменов:

``` bash
curl https://winhelp2002.mvps.org/hosts.txt -o hosts
```

      % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                     Dload  Upload   Total   Spent    Left  Speed

      0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
      0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
      0     0    0     0    0     0      0      0 --:--:--  0:00:01 --:--:--     0
      0     0    0     0    0     0      0      0 --:--:--  0:00:02 --:--:--     0
      0     0    0     0    0     0      0      0 --:--:--  0:00:03 --:--:--     0
      0     0    0     0    0     0      0      0 --:--:--  0:00:04 --:--:--     0
     14  327k   14 49152    0     0   9255      0  0:00:36  0:00:05  0:00:31  9455
     14  327k   14 49152    0     0   7786      0  0:00:43  0:00:06  0:00:37  9461
     24  327k   24 81920    0     0  10657      0  0:00:31  0:00:07  0:00:24 15943
     29  327k   29 98304    0     0  11911      0  0:00:28  0:00:08  0:00:20 20893
     34  327k   34  112k    0     0  12331      0  0:00:27  0:00:09  0:00:18 22701
     48  327k   48  159k    0     0  16078      0  0:00:20  0:00:10  0:00:10 23509
     48  327k   48  159k    0     0  14630      0  0:00:22  0:00:11  0:00:11 23480
     58  327k   58  191k    0     0  16201      0  0:00:20  0:00:12  0:00:08 25789
     68  327k   68  223k    0     0  17487      0  0:00:19  0:00:13  0:00:06 26981
     78  327k   78  255k    0     0  17839      0  0:00:18  0:00:14  0:00:04 27357
     78  327k   78  255k    0     0  16700      0  0:00:20  0:00:15  0:00:05 17855
     78  327k   78  255k    0     0  15697      0  0:00:21  0:00:16  0:00:05 17871
     78  327k   78  255k    0     0  14726      0  0:00:22  0:00:17  0:00:05 11566
     83  327k   83  271k    0     0  15318      0  0:00:21  0:00:18  0:00:03  9718
     88  327k   88  287k    0     0  14924      0  0:00:22  0:00:19  0:00:03  6472
     88  327k   88  287k    0     0  14512      0  0:00:23  0:00:20  0:00:03  7088
     88  327k   88  287k    0     0  13648      0  0:00:24  0:00:21  0:00:03  6677
     92  327k   92  303k    0     0  13765      0  0:00:24  0:00:22  0:00:02 10214
     92  327k   92  303k    0     0  13181      0  0:00:25  0:00:23  0:00:02  6034
     92  327k   92  303k    0     0  12621      0  0:00:26  0:00:24  0:00:02  3343
     92  327k   92  303k    0     0  12128      0  0:00:27  0:00:25  0:00:02  3068
    100  327k  100  327k    0     0  12932      0  0:00:25  0:00:25 --:--:--  9334

С помощью Python подготовим файл для анализа:

``` python
bad_hosts = []
with open('hosts') as file:
    for line in file.readlines()[27:]:
        if line[0] == '#':
            continue
        bad_hosts.append(line.split()[1])
```

Преобразуем полученную метаинформацию в пригодный к анализу вид:

``` python
hosts = []
with open('dns.log') as file:
    for line in file.readlines():
        if line[0] == '#':
            continue
        try:
            hosts.append(line.split()[9])
        except IndexError:
            continue
```

4. Посчитаем число вхождений DNS имен из списков в собранном трафике:

``` python
bad_count = len([host for host in hosts if host in bad_hosts])
percentile = round(bad_count/len(hosts),3)*100
print("{} вхождений DNS в список нежелательного трафика.".format(str(bad_count)),
"Процент нежелательного трафика: {}%.".format(str(percentile)),sep='\n')
```

    135 вхождений DNS в список нежелательного трафика.
    Процент нежелательного трафика: 6.1%.

## Оценка результата

В результате проделанной работы мы смогли определить нежелательный трафик.

## Вывод

Таким образом, мы научились использовать современный стек инструментов для анализа сетевого трафика.